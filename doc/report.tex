\documentclass{article}
\usepackage{fullpage}
%-----------------Hyperlink Packages--------------------
\usepackage{hyperref}
\hypersetup{
	 colorlinks   = true,
     citecolor    = black,
     linkcolor    = black,
     urlcolor     = black
}
%-----------------Figure Packages--------------------
\usepackage{graphicx}                       % For figures
\usepackage{stfloats}
\usepackage[tight,footnotesize]{subfigure}  % Create subfigures, ie 1A, 1B
%\usepackage{epsfig} % for postscript graphics files
%------------------Math Packages------------------------
\usepackage{amssymb,amsmath}
\usepackage{textcomp}
\usepackage{mdwmath}
\usepackage{mdwtab}
\usepackage{eqparbox}
%------------------Table Packages-----------------------
\usepackage{rotating}                     % Used to rotate tables
\usepackage{array}                        % Fixed column widths for tables
%-----------------Algorithm Packages--------------------
\usepackage{listings}                     % Source code
\usepackage{algorithm}                    % Pseudo Code
\usepackage[noend]{algpseudocode}
%---------------------------------------------------------

%opening
\title{}

\begin{document}
\bibliographystyle{acm}

\title{
Artificial Intelligence Project 1 \\
Binary Image Denoising
}
\author{Class 1, Team 6}
\date{\today}
\maketitle

\tableofcontents
\section{Team Members}

\begin{table}[H]
\centering
\begin{tabular}{l l l}
Name & Student ID  & Job\\
\hline
Fan Ziyao & 12330081 & \\
Chen Yingcong & 12330049 & \\
Chen Xiongtao & 12330040 & \\
Huang Long & 12330132 &  \\
Zhang Qiuyi & 12330402 & 
\end{tabular}
\end{table}

\section{Problem Description}
\paragraph{}
Let the observed noisy image be described by an array of binary pixel values $y_i \in \{−1, +1\}$, where the index $i = 1, ..., D$ runs over all pixels. We shall suppose that the image is obtained by taking an unknown noise-free image, described by binary pixel values $x_i \in \{−1, +1\}$ and randomly flipping the sign of pixels with some small probability, say, $10\%$. Given the noisy image, our goal is to recover the original noise-free image.

\section{Modeling}
\paragraph{}
Because the noise level is small, we know that there will be a strong correlation between $x_i$ and $y_i$. We also know that neighboring pixels $x_i$ and $x_j$ in an image are strongly correlated. This prior knowledge can be captured using the Markov random field model. This graph has two types of cliques, each of which contains two variables. The cliques of the form $\{x_i, y_i\}$ have an associated energy function that expresses the correlation between these variables. We choose a very simple energy function for these cliques of the form $-\eta x_i y_i$ where $\eta$ is a positive constant. This has the desired effect of giving a lower energy (thus encouraging a higher probability) when $x_i$ and $y_i$ have the same sign and a higher energy when they have the opposite sign.

The remaining cliques comprise pairs of variables $\{x_i, x_j\}$ where $i$ and $j$ are indices of neighboring pixels. Again, we want the energy to be lower when the pixels have the same sign than when they have the opposite sign, and so we choose an energy given by $-\beta x_i x_j$ where $\beta$ is a positive constant. 

Because a potential function is an arbitrary, non-negative function over a maximal clique, we can multiply it by any nonnegative functions of subsets of the clique, or equivalently we can add the corresponding energies. In this example, this allows us to add an extra term $hx_i$ for each pixel $i$ in the noise-free image. Such a term has the effect of biasing the model towards pixel values that have one particular sign in preference to the other. The complete energy function for the model then takes the form:

$$
E(\mathbf{x}, \mathbf{y}) = h \sum_{i}x_i - \beta\sum_{\{i, j\}}x_ix_j - \eta\sum_{i}x_iy_i
$$

which defines a joint distribution over x and y given by:

$$
p(\mathbf{x}, \mathbf{y}) = \frac{1}{Z}\exp\{-E(\mathbf{x}, \mathbf{y})\}
$$

Our goal is then defined as finding an $\mathbf{x}$ such that:

$$
\mathbf{x} = {\operatorname{arg\,min}} E(\mathbf{x}, \mathbf{y})
$$

\section{Algorithm and Implementation}

\paragraph{}
We now fix the elements of $y$ to the observed values given by the pixels of the noisy image, which implicitly defines a conditional distribution $p(x|y)$ over noise-free images. This is an example of the \textit{Ising model}, which has been widely studied in statistical physics. 

For the purposes of image restoration, we wish to find an image $x$ having a high probability (ideally the maximum probability). Since $E$ can be viewed as a function of $M \times N$ variables, with each variable representing a pixel value, we can use the method of gradient descent to search for the minimizer of $E$. More precisely, for each pixel $x_{i,j}$ we search by evaluating two possible states for $x_{i,j} = 1$ and $x_{i,j} = −1$, keeping all other pixel value fixed. The search will be repeated until some stopping criterion is satisfied.

It is easy to see that $E(x,y)$ is a non-convex function of $x$, which implies that there will be multiple local minima for $E$ depending on the initial state. To search for the global optimun, we need a global optimization strategy. In this project, we use \textit{simulated annealing}, which can be easily integrated with method of gradient descent.

The complete algorithm is shown in Algorithm ~\ref{alg:denoise}.

\begin{algorithm}
\centering
\caption{Binary image denoising with simulated annealing}
\label{alg:denoise}
  \begin{algorithmic}[1]
    \Function{Deniose}{$\mathbf{y}$, $\beta$, $\eta$, $h$}
        \Comment{$\mathbf{y}$ is the noisy image}
        \State Initialize $\mathbf{x}$ with $\mathbf{x} = \mathbf{y}$
        \State Initialize $Ebest$ with $Ebest = E(\mathbf{x}, \mathbf{y})$
	    \For{$k = 1 \to k_{max}$}
	    	\State Compute the temperature $t$ = temperature($k,k_{max}$)
	    	\For{each pixel $x_{i, j}$}
	    		\State $E_1 = E(\mathbf{x}, \mathbf{y})$
	    		\State $x_{i,j} = - x_{i,j}$ \Comment{flip the pixel}
	    		\State $E_2 = E(\mathbf{x}, \mathbf{y}$
	    		\State Compute the transition probability $p = prob(E_1, E_2, t)$
	    		\If{$p > q$ where $q$ is a random number in $[0, 1]$}
		    		\If{$E_2 < E_{best}$}
		    			\State Record the best energy $Ebest = E_2$
		    		\EndIf
		    	\Else
		    		\State $x_{i,j} = - x_{i,j}$ \Comment{flip the pixel back}
		    	\EndIf
	    	\EndFor
	    \EndFor
      \Return $x$
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{description}
\item Remark 1.\hfill \\
The temperature function is a decreasing function of iterations. It must converge to $0$ as $k \to k_{max}$. For this implementation we use

$$
\text{temperature}(k, k_{max}) = \frac{1}{500}(\frac{1}{k} - \frac{1}{k_{max}})
$$

\item Remark 2.\hfill \\
The probability transition function used for this implementation is

$$
prob(E_1, E_2, t) =  \left\{
     \begin{array}{lr}
       1 & : E_1 > E_2 \\
       \mathbf{e}^{\frac{E_1 - E2}{t}} & : E_1 \leq E_2
     \end{array}
   \right.
$$

\end{description}

\section{Experiment Result}

\begin{figure}[H]
	\begin{minipage}[b]{0.48\linewidth}
		\centering
		\includegraphics[width=180pt]{../img/in.png}
		\caption{Original image}
	\end{minipage}
	\begin{minipage}[b]{0.48\linewidth}
		\centering
		\includegraphics[width=180pt]{../img/flipped.png}
		\caption{Noisy image with 10\% flipped pixels}
	\end{minipage}
\end{figure}
\begin{figure}[H]
	\centering
	\begin{minipage}[b]{0.45\linewidth}
		\centering
		\includegraphics[width=180pt]{../img/best.png}
		\caption{Denoised with simulated annealing}
	\end{minipage}
	\begin{minipage}[b]{0.45\linewidth}
		\centering
		\includegraphics[width=180pt]{../img/icm.png}
		\caption{Denoised with ICM}
	\end{minipage}
\end{figure}

\section{Discussion}

\end{document}
